{% extends "basemd.html" %}
{% block title %}
	Return Items from Order to Project
{% endblock title %}
{% block menu %}
    {% include "menus/storagemd.htm" %}
{% endblock menu %}
{% block content %}
	<section ng-app="rioApp" ng-controller="rioC">
		<header>
			<h3>Devolver Items a Proyecto</h3>
		</header>
		<article class="card-panel">
			<div class="card-content row">
				<div class="col l6 m6 s12">
					<blockquote>
						<dl>
							<dt>Proyecto</dt><dd>{{ order.proyecto_id }} - {{ order.proyecto.nompro }}</dd>
							<dt>Subproyecto</dt><dd>{{ order.subproyecto_id }} - {{ order.subproyecto.nomsub }}</dd>
							<dt>Sector</dt><dd>{{ order.sector_id }} - {{ order.sector.nomsec }}</dd>
							<dt>Almacén</dt><dd>{{ order.almacen.nombre }}</dd>
							<dt>Realizado</dt><dd>{{ usr.user.first_name }} {{ usr.user.last_name }}</dd>
							<dt>Asunto</dt><dd>{{ order.asunto }}</dd>
						</dl>
					</blockquote>
				</div>
				<div class="col l6 m6 s12">
					<blockquote>
						<dl class="dl-horizontal">
							<dt>Registrado</dt><dd>{{ order.registrado }}</dd>
							<dt>Realizado</dt><dd>{{ order.traslado }}</dd>
							<dt>Observación</dt><dd>{{ order.obser|safe }}</dd>
							<dt>Estado</dt><dd>{{ order.status }}</dd>
							{% if order.orderfile %}
								<dt>Adjunto</dt><dd><a class="btn btn-default btn-xs btn-warning text-black" target="_blank" href="{{ MEDIA_URL }}/{{ order.orderfile }}"><span class="glyphicon glyphicon-download"></span></a></dd>
							{% endif %}
						</dl>
					</blockquote>
				</div>		
			</div>
		</article>
		{% if order.status == 'CO' or order.status == 'AN' %}
			<aside>
				<blockquote>
					<h4>No tiene items para ser devueltos.</h4>
				</blockquote>
			</aside>
		{% else %}
			<article>
				<div class="card">
					<div class="card-action">
						<h6>Seleccionar: </h6>
						<input type="radio" name="select" class="with-gap" id="all" ng-model="all" value="true">
						<label for="all" ng-click="all=true;nothing=false">Todo</label>
						<input type="radio" name="select" class="with-gap" id="nothing" ng-model="nothing" value="false" ng-click="nothing=true;all=false">
						<label for="nothing">Ninguno</label>
						<button type="button" class="btn waves-effect waves-light amber lighten-1 right" ng-click="returnItems()">
							<i class="fa fa-reply-all"></i>
							Devolver
						</button>
					</div>
				</div>
				<table class="hightlight responsive-table hovered">
					<thead>
						<tr class="amber lighten-5">
							<th></th>
							<th></th>
							<th>Código</th>
							<th>Descripción</th>
							<th>Marca</th>
							<th>Modelo</th>
							<th>Unidad</th>
							<th>Pedido</th>
							<th>Pendiente</th>
						</tr>
					</thead>
					<tbody>
					{% verbatim %}
						<tr ng-repeat="x in details">
							<td>{{$index + 1}}</td>
							<td>
								<input type="checkbox" id="{{x.pk}}" ng-model="mat[x.fields.materiales.pk]" ng-init="mat[x.fields.materiales.pk] = false" ng-checked="checkall(x.fields.materiales.pk)">
								<label for="{{x.pk}}"></label>
							</td>
							<td><small>{{x.fields.materiales.pk}}</small></td>
							<td>{{x.fields.materiales.fields.matnom}} {{x.fields.materiales.fields.matmed}}</td>
							<td>{{x.fields.brand.fields.brand}}</td>
							<td>{{x.fields.model.fields.model}}</td>
							<td>{{x.fields.materiales.fields.unidad}}</td>
							<td>{{x.fields.cantidad}}</td>
							<td>
								<input type="number" class="right-align" value="{{x.fields.cantshop}}" ng-disabled="mat[x.fields.materiales.pk] == false" max="{{x.fields.cantshop}}" min="0" step="0.001">
							</td>
						</tr>
					{% endverbatim %}
					</tbody>
				</table>
			</article>
		{% endif %}			
	</section>
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/angular/angular.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/angular-cookies/angular-cookies.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/almacen/returnitemsorders.js" defer></script>
{% endblock content %}